name: Server Uptime Check

on:
  schedule:
    - cron: '*/5 * * * *'  # every 5 minutes
  workflow_dispatch:

jobs:
  uptime_check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Check server status
      id: check_status
      run: |
        TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M:%S UTC")
        STATUS=$(curl -o /dev/null -s -w "%{http_code}" http://174.6.65.67)
        if [ "$STATUS" -eq 200 ]; then
          echo "Server is UP at $TIMESTAMP"
          echo "status_text=âœ… Server is UP at $TIMESTAMP" >> $GITHUB_ENV
        else
          echo "Server is DOWN (HTTP $STATUS) at $TIMESTAMP"
          echo "status_text=âŒ Server is DOWN (HTTP $STATUS) at $TIMESTAMP" >> $GITHUB_ENV
        fi
        echo "${status_text}" > server_status.txt

    - name: Commit and push server status
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: "Update server status at ${{ github.run_id }}"
        branch: main
        file_pattern: server_status.txt
